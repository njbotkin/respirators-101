
<div class="description content" style="margin-top: 20px">

<ol>
	<li>Use buttons below to enter sample information . </li>
	<li>Press Calculate button to get TWA </li>
</ol>

<p>NOTE ON HOURS: Take into account time when workers were NOT exposed to the hazard (for instance, on breaks). If a sample was taken at 11am and then again at 2pm, but the lunch hour was between 12pm and 1pm, the sample taken at 11am only represents 2 hours. </p>
	
</div>

<table>
	<thead>
		<tr>
			<th></th><th>PPM <br>Measured</th><th></th><th>Hours <br>Represented</th><th></th><th>PPM-hours</th>
		</tr>
	</thead>
	<tbody>

	{ #each samples as sample, i }
		<tr class="sample">
			<td><label><span class="optional">Sample </span>{i + 1}</label></td>
			<td><input type="text" bind:value="sample.ppm" placeholder="0" /></td>
			<td>&#215;</td>
			<td><input type="text" bind:value="sample.hours" placeholder="0" /></td>
			<td>=</td>
			<td><div class="result">{ round(sampleProducts[i]) }</div></td>
		</tr>
	{ /each }
		
	</tbody>
</table>

{ #if validSamples.length === samples.length && (totalHours > hours || totalHours < hours) }
	<div class="wrong-hours">The total hours of the samples you've entered is { totalHours > hours ? 'greater' : 'less' } than the length of workday you selected ({hours} hours).  If you need, <a href="{asr.makePath('app.generate-table')}">go back</a> and change your workday length.</div>
{ /if }

<h3>TWA Equation:</h3>

<div class="equation">

	<div class="operand">
		<div class="value">{ round(totalPPMHours) }</div>
		<div class="unit">Total <br>PPM-hours</div>
	</div>

	<div class="operator">&#247;</div>

	<div class="operand">
		<div class="value">{ round(totalHours) }</div>
		<div class="unit">Total <br>hours</div>
	</div>

	<div class="operator">=</div>

	<div class="operand">
		<div class="value">{ round(twa) }</div>
		<div class="unit">TWA</div>
	</div>

</div>

<div class="button valid{ valid }"> Use TWA </div>

<style>

	@import 'colors';

	table {
		margin: 20px auto;

		th {
			font-weight: normal;
			color: #666;
			line-height: 1.2;
			font-size: 90%;
		}

		.sample {

			label {
				font-size: 90%;
				font-weight: bold;
				color: $blue2;
			}

			input {
				display: inline-block;
				font-size: 110%;
				margin: 0 10px;
				width: 60px;
				line-height: 40px;
				padding: 0 10px;
				border: 1px solid #aaa;
			}

			.result {
				display: inline-block;
				font-size: 110%;
				margin: 0 10px;
			}

		}
	}

	@media screen and (max-width: 400px) {
		.optional {
			display: none;
		}
	}

	h3 {
		text-align: center;
	}

	.equation {
		text-align: center;

		> div {
			display: inline-block;
			margin: 0 6px;
			vertical-align: middle;
		}

		.operand {
			.value, .unit {
				display: block;
				text-align: center;
			}

			.value {
				font-size: 150%;
			}
			.unit {
				color: #666;
				line-height: 1.2;
				font-size: 90%;
			}
		}

		.operator {
			font-size: 120%;
		}
	}

	.wrong-hours {
		background: $red3;
		color: #fff;
		padding: 15px;
		font-size: 80%;

		a {
			color: #fff;
		}
	}

	.button {

		padding: 30px;
		display: block;
		text-decoration: none;
		max-width: 300px;
		margin: 20px auto;
		cursor: default;
		background: #aaa;
		color: #666;
		text-align: center;
		font-size: 20px;

		&.validtrue {
			cursor: pointer;
			background: $blue2;
			color: #fff;
		}
	}

</style>


<script>

import { number, round } from 'lib/util.js'

export default {
	computed: {
		validSamples: ({ samples }) => samples.filter(s => !!(number(s.ppm) && number(s.hours))),
		sampleProducts: ({ samples }) => samples.map(s => number(s.ppm) && number(s.hours) ? number(s.ppm) * number(s.hours) : 0),
		valid: ({ sampleProducts, totalHours, hours, twa }) => { 
			if(totalHours > hours || totalHours < hours) return false
			for(var t of sampleProducts) { 
				if(t === 0) return false
			} 
			if(twa === Infinity) return false
			return true;
		},
		totalPPMHours: ({ sampleProducts }) => sampleProducts.reduce((a, t) => a + t, 0),
		totalHours: ({ samples }) => samples.reduce((a, s) => number(s.hours) ? a + number(s.hours) : a, 0),
		twa: ({ totalPPMHours, totalHours }) => totalPPMHours / totalHours || 0 
	},
	helpers: {
		round
	}
}

</script>