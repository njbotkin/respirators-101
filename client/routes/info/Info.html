<div class="body">
	<div class="construction">
		Under construction
	</div>
</div>

<div class="content">

	{ #if Object.keys($jobs).length === 0 }

		<div class="nojobs">
			You haven't saved any jobs yet!

			Click 'add a job' to start, and any information you gather will be automatically saved to the current job.
		</div>

	{ /if }

	<button class="addjob" on:click="$addJob()">Add a Job</button>

	<div class="jobs">
		
		{ #each Object.entries($jobs) as [jobId, job] }
			<div class="job currentJob{ jobId == $currentJobId } editing{ jobId === editingId }">
				<div class="title">
					<div class="name">
						{ #if jobId === editingId }
							<input type="text" bind:value="job.name">
						{ :else }
							{ job.name }
						{ /if }
					</div>
					<div class="date">{ date(job.date) }</div>
					<div class="cfx"></div>
				</div>
				<div class="content">
					
					{ #if job.chemical }<Chemical c="{ job.chemical }"></Chemical>{ /if }

				</div>

				<div class="buttons">
					{ #if jobId === editingId }
						<button class="stopEditing" on:click="set({ 'editingId': null })">Done</button>
					{ :else }
						<button class="editJob" on:click="set({ 'editingId': jobId })">Edit Job</button>
					{ /if }

					<button class="deleteJob" on:click="set({ deleteModal: jobId })">Delete Job</button>
				</div>

			</div>
		{ /each }

	</div>

	{ #if deleteModal }

		<Modal bind:show="deleteModal">
			<p>Are you sure want to delete <b>{ $jobs[deleteModal].name }</b>?  This cannot be undone.</p>
			<div class="buttons">
				<button class="deleteJob" on:click="deleteJob(deleteModal)">Delete Job</button>
				<button class="deleteJob" on:click="set({ deleteModal: false })">Never mind</button>
			</div>
		</Modal>

	{ /if }

</div>

<!-- computed: {
	dynamicRef: (data) => data[data.key]
} -->

<script>

	// import chemicals from 'data/chemicals.json'
	import Chemical from 'lib/Chemical.html'
	import jobs from 'lib/storage.js'
	import date from 'date-and-time'
	import Modal from 'lib/Modal.html'

	// console.log(chemicals[0].forms.regular)
	
	export default {
		components: {
			Chemical,
			Modal
		},
		store: () => jobs,
		methods: {
			deleteJob(id) {
				this.set({ deleteModal: 0 })
				jobs.removeJob(id)
			}
		},
		helpers: {
			date: (d) => date.format(new Date(d), 'MMM D, YYYY h:mm A')
		},
		data: () => ({
			editingId: null,
			deleteModal: false,
			// jobs: jobs.serializeJobs(),
			// currentJobId: jobs.currentJobId
/*			jobs: [
				{
					name: 'Clean  inside  tank  at  SpedCo',
					date: 'May 11, 2017 1:35PM',
					details: {
						chemical: chemicals[0],
						measured: {
							"regular": {
								"osha_pel": {
									"regular": {
										ppm: 40
									}
								},
								"cal_osha_pel": {
								},
								"niosh_rel": {
								}
							}

						}
					}
				},
				{
					name: 'Painting  primer  on  new  doors ',
					date: 'May 10, 2017 10:15AM',
					details: {
						chemical: chemicals[500],
						measured: {
							"regular": {
								"osha_pel": {
								},
								"cal_osha_pel": {
									"stel": {
										ppm: 1
									}
								},
								"niosh_rel": {
								}
							}

						}
					}
				},
				{
					name: 'HAZMAT Cleanup at Waverly Oil',
					date: 'May 1, 2017 9:01AM',
					details: {
						chemical: chemicals[200],
						measured: {
							"regular": {
								"osha_pel": {
								},
								"cal_osha_pel": {
								},
								"niosh_rel": {
									"regular": {
										mgm3: .2
									}
								}
							}

						}
					}
				},
			]*/
		})
	}

</script>

<style>

	.body {
		text-align: center;
	}

	.construction {
		display: inline-block;
		margin: 50px auto 20px;
		padding: 20px 40px;
		font-size: 200%;
		position: relative;
	}

	.construction:before {
		position: absolute;
		top: 50%;
		left: 0;
		margin-top: -16px;
		content: "\f06a";
		/* use !important to prevent issues with browser extensions that change fonts */
		font-family: 'icomoon' !important;
		speak: none;
		font-style: normal;
		font-weight: normal;
		font-variant: normal;
		text-transform: none;
		line-height: 1;

		/* Better Font Rendering =========== */
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;

		font-size: 30px;
		color: #999;
	}

	.buttons {
		text-align: right;
	}

	.job {
		position: relative;
		background: #fff;
		padding: 10px;
		overflow: hidden;
		margin: 5px;

		.name {
			font-weight: bold;
			float:left;
		}
		.date {
			float:right;
		}
		.cfx {
			clear:both;
			content: ' ';
		}

		.content {
			margin-top: 10px;
			border-top: 1px solid #ddd;
			padding: 10px 0 0;
		}

		table {
			border-collapse: collapse;
			td {
				border: 1px solid #ddd;
				&.sub {
					text-align: right;
				}
			}
		}

		&.currentJobtrue {
			border: 1px solid green;
		}
	}

</style>

<!--
job

	name
	date

	chemical
		exposure limits (in PPM, I guess) etc

		- connected: my measured concentration 




-->