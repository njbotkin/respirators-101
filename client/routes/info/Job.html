{ #if job && $job } <!-- because weird binding issues -->
{ #if job.id == $job.id && !only }<div class="currentJob">Current Job</div>{ /if }

<div class="job currentJob{ job.id == $job.id }">
	<div class="title">

		<div class="name">
			{ #if editingName && job.id == $job.id }
				<input type="text" bind:value="job.name" style="width:{nameWidth}px"><a class="stopEditing edit" on:click="set({ editingName: false })">[done]</a>
			{ :else }
				<span>{ job.name }</span><a class="editJob edit" on:click="set({ editingName: true, nameWidth: this.previousSibling.offsetWidth })">[edit]</a>
			{ /if }
		</div>

		<div class="date">
			{ #if editingDate && job.id == $job.id }
				<input type="date" bind:value="job.date"><a class="stopEditing edit" on:click="set({ editingDate: false })">[done]</a>
			{ :else }
				<span>{ date(job.date) }</span><a class="editDate edit" on:click="set({ editingDate: true })">[edit]</a>
			{ /if }
		</div>

		<div class="cfx"></div>
	</div>
	<div class="content">

		<Warnings />

		<div class="read-value live{job.id == $job.id }">
			<div class="legend-cont"><div class="legend"> Exposure Limit </div></div>
				{ #if job.exposureLimit.value }
					<ExposureLimits exposureLimit="{job.exposureLimit}" />
				{ :else }
					No exposure limit selected yet!
				{ /if }
			<div class="button-cont"><a class="button edit" href="{ asr.makePath(valueSources['exposureLimit']) }"> Edit </a></div>
		</div>

		<div class="read-value live{job.id == $job.id }">
			<div class="legend-cont"><div class="legend"> TWA </div></div>
				{ #if job.twa.final }
					<div class="representation">
						{ round(job.twa.final) }
						<div class="unit">{ @html unitsPretty[job.twa.unit] }</div>
					</div>
				{ :else }
					No TWA set yet!
				{ /if }
			<div class="button-cont"><a class="button edit" href="{ asr.makePath(valueSources['twa']) }"> Edit </a></div>
		</div>

		<div class="read-value live{job.id == $job.id }">
			<div class="legend-cont"><div class="legend"> HR </div></div>
				{ #if job.hr }
					{ round(job.hr) }
				{ :else }
					No HR set yet!
				{ /if }
			<div class="button-cont"><a class="button edit" href="{ asr.makePath(valueSources['hr']) }"> Edit </a></div>
		</div>

	</div>

	{ #if !only }
		<div class="buttons">
			{ #if job.id !== $job.id }<div class="button switchJob" on:click="fire('switchJob', job.id)">Select</div>{ /if }
			<div class="button duplicateJob" on:click="fire('duplicate', job.id)">Duplicate</div>
			<div class="button deleteJob" on:click="fire('confirmDelete', job.id)">Delete</div>
		</div>
	{ /if }

</div>

{ /if }

<script>

	import date from 'date-and-time'
	import { valueSources } from 'lib/storage.js'
	import { round, unitsPretty } from 'lib/util.js'

	export default {
		components: {
			ExposureLimits: 'lib/ExposureLimits.html',
			Warnings: 'lib/Warnings.html'
		},
		helpers: {
			date: (d) => date.format(new Date(d), 'MMM D, YYYY', true),
			round
		},
		data: () => ({
			valueSources,
			only: false,
			unitsPretty
		})
	}

</script>

<style>

	@import 'colors';

	.currentJob {
		color: $green;
		font-size: 80%;
		text-transform: uppercase;
		font-weight: bold;
		margin-bottom: -10px;
		margin-top: 10px;
	}
	
	.job {
		position: relative;
		padding: 20px;
		overflow: hidden;
		margin: 10px 0;
		/*border: 2px solid #fff;*/

		@media (max-width: 400px) {
			padding: 10px;
		}

		.name {
			float:left;

			span, input {
     			display: inline-block;
				border: 1px solid;
				padding: 1px 4px;
				font-size: 100%;
				line-height: 1.4;
				font-family: 'Open Sans';
				font-weight: bold;
				box-sizing: border-box;
			}

			span { border-color: transparent; }
			input { border-color: grey; }
		}
		.cfx {
			clear:both;
			content: ' ';
		}

		.content {
			margin-top: 10px;
			border-top: 1px solid #ddd;
			padding: 0;
		}

		.editJob, .editDate, .stopEditing {
			font-size: 80%;
			color: #4260b5;
			cursor: pointer;
			font-weight: 400;
			margin-left: 5px;
		}
		.date {
			float:right;
		}

		&.currentJobtrue {
			background: #fff;
			/*border-color: color($green l(+20%));*/

			.legend {
				background: #fff;
			}
		}

		&.currentJobfalse {
			.edit {
				display: none;
			}
		}

		.buttons {
			margin-top: 10px;
			text-align: right;
		}

		.deleteJob.button {
			background: $red2;
			&:active {
				background: linear-gradient(color($red2 l(-5%)), color($red2 l(+5%)));
			}
		}

		.duplicateJob.button {
			background: $blue2;
			&:active {
				background: linear-gradient(color($blue2 l(-5%)), color($blue2 l(+5%)));
			}
		}

		.switchJob.button {
			background: $green;
			&:active {
				background: linear-gradient(color($green l(-5%)), color($green l(+5%)));
			}
		}

		/* slightly less awkward layout */
		/*.clump {
		    display: inline-block;
		    width: 100px;
		}*/
	}

</style>