{ #if showKeys }
	<div class="keys">
		<div class="key form">State</div>
		<div class="key duration">Measurement duration</div>
		<div class="key EL">Exposure Limit</div>
	</div>
{ /if }

{ #if standards_sorted_array }
	<div class="property-list float">
		{ #each standards_sorted_array as [standardKey, standard] }

			<div class="property standard"> 
				<div class="label">{ standardsPretty[standardKey] }</div>
				<div class="value property-list">

					{#if standardKey == 'osha_pel' && osha_pel}<div class="raw">{@html osha_pel}</div>{/if}
					{#if standardKey == 'niosh_rel' && niosh_rel}<div class="raw">{@html niosh_rel}</div>{/if}
					{#if standardKey == 'cal_osha_pel' && cal_osha_pel}<div class="raw">{@html cal_osha_pel}</div>{/if}

					{ #if standard.forms }{ #each Object.entries(standard.forms) as [formKey, form] }
						<div class="property form">
							{ #if formKey !== 'Default' }<div class="label">{@html formKey }</div>{ /if }
							<div class="value property-list">

								{ #each Object.entries(form.durations) as [durationKey, duration] }
									<div class="property property-list duration">
										{ #if durationKey !== 'default' }<div class="label">{ durationsPretty[durationKey] }</div>{ /if }
										<div class="value">

											<span class="period">{ humanTime(duration.duration) }</span>

											{ #each Object.entries(duration.values) as [unit, value] }

												<div class="representation select-el EL" on:click="fire('confirmSaveEL', { chemical_name, formKey, standardKey, durationKey, value, unit, duration: duration.duration, eyes, idlh, idlh_notes, chemical_name })" data-active="{ elSame({ chemical_name, formKey, standardKey, durationKey, unit, value }, $job.exposureLimit) }">
													{ value }
													<div class="unit">{ @html unitsPretty[unit] }</div>
												</div>

											{ /each }

										</div>

										{#if duration.max}
											<div class="property max">
												<div class="label">Max peak</div>
												<div class="value">{ duration.max }</div>
											</div>
										{/if}
									</div>
								{ /each }
								
								{ #if form.notes }
									{ #each form.notes as note }
										<div class="notes">{@html note }</div>
									{ /each }
								{ /if }

							</div>
						</div>
					{ /each }{ /if }

					{ #if standard.carcinogens }
						<span class="carcinogens">Carcinogen</span>
					{ /if }
					{ #if standard.notes }
						{ #each standard.notes as note }
							<div class="notes">{@html note }</div>
						{ /each }
					{ /if }

				</div>
			</div>

		{ /each }
	</div>
{ /if }

{ #if exposureLimit }

	{ #if exposureLimit.manual }

		<div class="lone property">
			<div class="value">

				{ humanTime(exposureLimit.duration) }

				<div class="representation select-el EL">
					{ exposureLimit.value }
					<div class="unit">{ @html unitsPretty[exposureLimit.unit] }</div>
				</div>

			</div>
		</div>

	{ :else }

		<div class="property standard"> 
			<div class="label">{ standardsPretty[exposureLimit.standardKey] }</div>
			<div class="value">

				<div class="property form">
					<div class="label">{ #if exposureLimit.formKey !== 'default' }{ exposureLimit.formKey }{ /if }</div>
					<div class="value property-list">

						<div class="property duration">
							<div class="label">{ #if exposureLimit.durationKey !== 'default' }{ durationsPretty[exposureLimit.durationKey] }{ /if }</div>
							<div class="value">

								{ humanTime(exposureLimit.duration) }

								<div class="representation select-el EL">
									{ exposureLimit.value }
									<div class="unit">{ @html unitsPretty[exposureLimit.unit] }</div>
								</div>

							</div>
						</div>

					</div>
				</div>

			</div>
		</div>

		<div>{ exposureLimit.chemical_name }</div>

		{ #if exposureLimit.idlh }
			<div class="property inline" style="padding: 0; margin: 0">
				<div class="label">IDLH</div>
				<div class="value">{ @html exposureLimit.idlh }</div>
				<div class="notes">{ @html exposureLimit.idlh_notes }</div>
			</div>
		{ /if }

		{ #if exposureLimit.eyes }
			<div class="eye">Eye irritant</div>
		{ /if }

	{ /if }

{ /if }

<script>

	import { unitsPretty } from 'lib/util.js'

	function propertiesMatch(a, b) {
		for(let k in a) if(a[k] !== b[k]) return false
		return true
	}

	const standards_order = {
		'niosh_rel': 0,
		'osha_pel': 1,
		'cal_osha_pel': 2
	}

	export default {
		helpers: {
			humanTime: time => time >= 60 ? `${time/60} hour${time>60?'s':''}` : `${time} minute${time>1?'s':''}`,
			elSame: propertiesMatch
		},
		data: () => ({
			showKeys: false,
			standardsPretty: {
				osha_pel: "OSHA PEL",
				cal_osha_pel: "Cal/OSHA PEL 8-hour TWA",
				niosh_rel: "NIOSH REL Up to 10-hour TWA"
			},
			durationsPretty: {
				ceiling: "Ceiling",
				stel: "STEL"
			},
			unitsPretty
		}),
		computed: {
			standards_sorted_array: ({standards}) => standards ? Object.entries(standards).sort( ([standard_a], [standard_b]) => standards_order[standard_a] - standards_order[standard_b] ) : null
		}
	}

</script>

<style>

	@import 'colors';

	$formSolid: $yellow1;
	$formText: $yellow2;

	$standardSolid: #8392ca;
	$standardText: #7580AA;

	$durationSolid: #999;
	$durationText: #777;

	$ELSolid: $red1;
	$ELText: #ce817f;

	.keys {
		margin-bottom: 10px;
	}
	.key {
		display: inline-block;
		line-height: 1;
		border-left: 12px solid;
		font-size: 12px;
		font-weight: bold;
		padding: 0 4px;
	}
	.form {
		border-color: $formSolid;
		color: $formText; 
	}
	.standard {
		border-color: $standardSolid;
		color: $standardText;
	}
	.duration {
		border-color: $durationSolid;
		color: $durationText;
	}
	.EL {
		border-color: $ELSolid;
		color: $ELText;
	}

	.select-el {
		cursor: pointer;
		padding: 5px;
		border: 1px solid;
		vertical-align: middle;
		margin: 0 4px;

		&:hover {
			background: #eee;
		}

		&[data-active=true] {
			background: $ELText;
			color: #fff;
		}
	}

	.eye {
		display: inline-block;
	    border: 1px solid $red1;
	    line-height: 2;
	    padding: 0 5px;
	    color: $red1;
	    font-size: 70%;
	    text-transform: uppercase;
	    margin-left: 5px;

	    &::before {    
	    	content: '\e8f4';
		    font-family: 'icomoon' !important;
		    font-size: 140%;
		    line-height: 1;
		    vertical-align: text-top;
		    margin-right: 3px;
	    }
	}

	.property {
		padding: 0 10px;
		/*margin: 10px 0;*/

		.label {
			padding-bottom: 4px;
		}

		&:first-child { margin-top: 0; }
		&:last-child { margin-bottom: 0; }
	}

	.property-list.float {
		> .property {
			display: inline-block;
		}
	}

	.property.max {
		padding: 0;
		border: 0;
		color: #bd0000;
		.label {
			padding: 0;
		}
		.value { 
			font-size: 80%;
    		max-width: 200px;
		}
	}

	.period {
		font-size: 80%;
	}

	.raw {
		max-width: 200px;
		font-size: 80%;
		margin: 0 10px 10px;
	}

</style>