<style>
		
	:global(.el-window.fo-realz .option) {
		font-size: 80%;

		&.active {
			border-color: #ce817f;
			color: #ce817f;
		}

		:global(.name) {
			padding: 0 10px;
			line-height: 30px;
		}
	}

	.current-unit {
	    color: #ce817f;
	    font-weight: bold;
	    letter-spacing: -.5px;
	    font-size: 80%;
	    margin: 5px;
	    display: inline-block;
	    user-select: none;
	    box-sizing: border-box;
	    border: 2px solid #ce817f;
	    padding: 0 10px;
	    line-height: 30px;

	    :global(sup) {
	    	line-height: 1;
	    }
	}

</style>

<div class="read-value live{ editing } el-window fo-realz" style="text-align: left">
	<div class="legend-cont"><div class="legend"> Exposure Limit </div></div>

	{ #if chemical || manual }
		<ExposureLimits {...props} />
	{ :else }
		No exposure limit selected yet!
	{ /if }

	{ #if switchable && editing }
		<ButtonSelect options="{ switchable }" bind:value="$job.exposureLimit.unit" />
	{ :elseif unit }
		<span class="current-unit">{@html unitsPretty[unit] }</span>
	{ /if }

	{#if editing}<div class="button-cont"><div class="button" on:click="$set({ editEL: true })"> { (chemical || manual) ? 'Edit' : 'Add' } </div></div>{/if}
</div>

<script>
	import { EL_is_current, arraySame, unitsPretty } from 'lib/util.js'

	export default {
		components: {
			ExposureLimits: 'lib/ExposureLimits.html',
			ButtonSelect: 'lib/ButtonSelect.html',
		},
		helpers: {
			unitsPretty
		},
		computed: {
			props: state => state, 
			switchable: ({ chemical, standardKey, formKey, $job }) => {
				if(!$job || !$job.exposureLimit.chemical || !chemical) return false

				if(EL_is_current( { chemical, standardKey, formKey }, $job.exposureLimit )) {

					let durations = Object.values(chemical.standards[standardKey].forms[formKey].durations)

					// all durations must share the same units to switch
					for(let d of durations) {
						if(!arraySame(Object.keys(d.values), Object.keys(durations[0].values))) {
							return false
						}
					}

					return Object.keys(durations[0].values).reduce((o, k) => (o[k] = unitsPretty[k], o), {})
				}
			}
		}
	}
</script>