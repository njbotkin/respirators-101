<div class="property">
	<div class="label">Exposure Limit</div>
	<input type="number" bind:value="value" placeholder="0" />
	<ButtonSelect options="{ unitsPretty }" bind:value="unit" />
</div>

<div class="property">
	<div class="label">Measurement Duration</div>
	<input type="number" bind:value="duration" placeholder="0" />
	<ButtonSelect options="{ timeUnits }" bind:value="timeUnit" />
</div>

<div style="text-align: right"><div class="button { valid && 'valid' }" on:click='save()'>Save</div></div>

<script>

	import { number, unitsPretty } from 'lib/util.js'
	let timeUnits = {
		'Hours': 'Hours',
		'Minutes': 'Minutes'
	}

	export default {
		components: {
			ButtonSelect: 'lib/ButtonSelect.html'
		},
		data: () => ({
			unitsPretty,
			timeUnits
		}),
		oncreate() {
			this.set( this.store.get().job.exposureLimit )
		},
		onstate({current, changed}) {
			if(changed.timeUnit) {
				let duration
				if(current.timeUnit == 'Hours') {
					duration = current.duration / 60
				} else {
					duration = current.duration * 60
				}
				this.set({ duration })
			}
		},
		computed: {
			valid: ({ duration, value, unit }) => {
				if(!number(duration) || !number(value) || !unit) return false
				return true
			}
		},
		methods: {
			save() {
				let { valid, unit, duration, value, timeUnit } = this.get()
				if(!valid) return
				if(timeUnit == 'Hours') duration *= 60
				this.store.set({ job: { exposureLimit: { unit, duration, value, manual: true } }, editEL: false })
			}
		}
	}

</script>

<style>

	@import 'colors';
	
	.property {
		display: block;
		padding: 0;
		margin: 10px 0;

		input {
			line-height: 40px;
			padding: 0 8px;
			width: 50px;
			font-size: 120%;
			font-family: 'Open Sans';
			border: 1px solid #bbb;
		}
	}

	.button {
		cursor: default;

		&.valid {
			cursor: pointer;
			background: $blue2;
		}
	}

</style>

